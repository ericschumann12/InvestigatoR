<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>This function is used to use ML to predict the returns that will later be used for a trading strategy — backtesting_returns • InvestigatoR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="This function is used to use ML to predict the returns that will later be used for a trading strategy — backtesting_returns"><meta property="og:description" content="This function is used to use ML to predict the returns that will later be used for a trading strategy"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">InvestigatoR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ericschumann12/InvestigatoR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>This function is used to use ML to predict the returns that will later be used for a trading strategy</h1>
    <small class="dont-index">Source: <a href="https://github.com/ericschumann12/InvestigatoR/blob/HEAD/R/backtesting_returns.R" class="external-link"><code>R/backtesting_returns.R</code></a></small>
    <div class="hidden name"><code>backtesting_returns.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function is used to use ML to predict the returns that will later be used for a trading strategy</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">backtesting_returns</span><span class="op">(</span></span>
<span>  <span class="va">data_ml</span>,</span>
<span>  return_prediction_object <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">return_label</span>,</span>
<span>  <span class="va">features</span>,</span>
<span>  rolling <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">window_size</span>,</span>
<span>  step_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  offset <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  in_sample <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">ml_config</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  num_cores <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>return_prediction_object</dt>
<dd><p>an object of class returnPrediction that should be used to store the predictions. Defaul(NULL) creates a new one.
In case an existing object is passed, given append=TRUE, new predictions are added. If append=FALSE, the object is overwritten.</p></dd>


<dt>return_label</dt>
<dd><p>the prediction label that should be used for the ML model. It should already be appropriately shifted (and date t the label should be from date t+1).</p></dd>


<dt>features</dt>
<dd><p>a vector of features that should be used for the ML model.</p></dd>


<dt>rolling</dt>
<dd><p>if TRUE, the function will use a rolling window approach to predict the returns. If FALSE, the function will use an expanding window approach.</p></dd>


<dt>window_size</dt>
<dd><p>(either in number of time steps or in years or months as "1 year" or "1 month"!) the size of the window that should be used for the
rolling window approach. if rolling=FALSE this is the starting window for the expoaning window approach</p></dd>


<dt>step_size</dt>
<dd><p>the amount of days the prediction window should be moved forward. Default is 1. If (e.g.) set to three, returns will be predicted for t, t+1 and t+2
(corresponding to t+1 and t+2 and t+3) in the original datset. Only then will the ML model be retrained.</p></dd>


<dt>offset</dt>
<dd><p>(either in number of time steps or in years or months as "1 year" or "1 month"!) the size of data that should be left unused between training data
and prediction (to avoid look-ahead bias). Default is 0.</p></dd>


<dt>in_sample</dt>
<dd><p>if TRUE, the function will also provide (in-sample) predictions for the training period (+ offfest)</p></dd>


<dt>ml_config</dt>
<dd><p>a list that contains the configuration for the ML model. It should contain the following elements:</p></dd>


<dt>append</dt>
<dd><p>if TRUE, the function will append the predicted returns to the original dataset. If FALSE, the function will return a new dataset that contains the
predicted returns.</p></dd>


<dt>data</dt>
<dd><p>ML dataset (tibble/data.frame) in long format that should contain the features and the return_label as well as the stock_ids (first column) and
dates (second column). FOr most ML algorithms to work this data set should not contain missing values. Sometimes it needs
to be balanced in terms of number of stocks available at each point in time.</p></dd>


<dt>verbose</dt>
<dd><p>num_cores the number of cores that should be used for parallel processing. If set to NULL the ML iterations will be done sequentially.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a tibble with the stock_id, date and the predicted returns</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data_ml</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_ml</span></span></span>
<span class="r-in"><span><span class="va">return_label</span> <span class="op">&lt;-</span> <span class="st">"R1M_Usd"</span></span></span>
<span class="r-in"><span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Div_Yld"</span>, <span class="st">"Eps"</span>, <span class="st">"Mkt_Cap_12M_Usd"</span>, <span class="st">"Mom_11M_Usd"</span>, <span class="st">"Ocf"</span>, <span class="st">"Pb"</span>, <span class="st">"Vol1Y_Usd"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rolling</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>; <span class="va">window_size</span><span class="op">=</span> <span class="st">"5 years"</span>; <span class="va">step_size</span> <span class="op">=</span> <span class="st">"3 months"</span>; <span class="va">offset</span> <span class="op">=</span> <span class="st">"1 year"</span>; <span class="va">in_sample</span> <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="va">ml_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ols_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pred_func<span class="op">=</span><span class="st">"ols_pred"</span>, config<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  xgb_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pred_func<span class="op">=</span><span class="st">"xgb_pred"</span>, config1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds<span class="op">=</span><span class="fl">100</span>, max_depth<span class="op">=</span><span class="fl">3</span>, eta<span class="op">=</span><span class="fl">0.3</span>, objective<span class="op">=</span><span class="st">"reg:squarederror"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                                    config2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds<span class="op">=</span><span class="fl">100</span>, max_depth<span class="op">=</span><span class="fl">4</span>, eta<span class="op">=</span><span class="fl">0.1</span>, objective<span class="op">=</span><span class="st">"reg:squarederror"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu">backtesting_returns</span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>, return_prediction_object<span class="op">=</span><span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>  <span class="va">return_label</span>, <span class="va">features</span>, <span class="va">rolling</span>, <span class="va">window_size</span>, <span class="va">step_size</span>, <span class="va">offset</span>, <span class="va">in_sample</span>, <span class="va">ml_config</span>, append<span class="op">=</span><span class="cn">FALSE</span>, num_cores<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Eric Schumann, Andreas Pischetsrieder, Christian Mahrun, Noah Veltri, Nicolas Baumann.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

